import{g as c}from"./vendor-30kCyqeT.js";async function p(t){const n={baseUrl:"/vendor/nutrient/",styleSheets:["/vendor/nutrient/styles.css"],enableAnnotations:!0,autoSaveMode:c.AutoSaveMode.INTELLIGENT,...t};try{const o=await c.load(n);return console.log("✅ Nutrient PDF viewer loaded successfully"),o}catch(o){throw console.error("❌ Failed to load Nutrient PDF viewer:",o),o}}async function u(t){if(!t)throw new Error("No PDF viewer instance provided");try{return await t.exportInstantJSON()}catch(n){throw console.error("Failed to export annotations:",n),n}}async function w(t,n){if(!t)throw new Error("No PDF viewer instance provided");try{await t.importInstantJSON(n),console.log("✅ Annotations imported successfully")}catch(o){throw console.error("Failed to import annotations:",o),o}}async function f(t,n,o){const a=await u(n),e=await fetch(`/api/pdf/${t}/annotations`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o,Accept:"application/json"},body:JSON.stringify({annotations:a.annotations||[]})});if(!e.ok){const r=await e.json();throw new Error(r.message||"Failed to save annotations")}return await e.json()}async function h(t,n){const o=await fetch(`/api/pdf/${t}/annotations`);if(!o.ok)throw new Error("Failed to load annotations");const a=await o.json();if(a.annotations&&a.annotations.length>0){const e={format:"https://pspdfkit.com/instant-json/v1",annotations:a.annotations.map(r=>r.annotation_data)};await w(n,e)}}function v(t,n,o,a=2e3){var d;let e=null;const r=((d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.content)||"",s=()=>{e&&clearTimeout(e),e=setTimeout(async()=>{try{await f(n,t,r),o&&o(null)}catch(l){console.error("Autosave failed:",l),o&&o(l)}},a)},i={create:()=>s(),update:()=>s(),delete:()=>s()};return t.addEventListener("annotations.create",i.create),t.addEventListener("annotations.update",i.update),t.addEventListener("annotations.delete",i.delete),()=>{t.removeEventListener("annotations.create",i.create),t.removeEventListener("annotations.update",i.update),t.removeEventListener("annotations.delete",i.delete),e&&clearTimeout(e)}}async function y(t,n=null){if(!t)return 0;try{if(n!==null)return(await t.getAnnotations(n)).size;{let o=0;const a=t.totalPageCount;for(let e=0;e<a;e++){const r=await t.getAnnotations(e);o+=r.size}return o}}catch(o){return console.error("Failed to get annotation count:",o),0}}async function m(t,n){if(!t)throw new Error("No PDF viewer instance provided");try{await t.setViewState(o=>o.set("currentPageIndex",n))}catch(o){throw console.error("Failed to navigate to page:",o),o}}async function F(t,n="document.pdf"){if(!t)throw new Error("No PDF viewer instance provided");try{const o=await t.exportPDF(),a=new Blob([o],{type:"application/pdf"}),e=URL.createObjectURL(a),r=document.createElement("a");r.href=e,r.download=n,r.click(),URL.revokeObjectURL(e)}catch(o){throw console.error("Failed to download PDF:",o),o}}async function P(t){if(!t)throw new Error("No PDF viewer instance provided");try{await t.print()}catch(n){throw console.error("Failed to print PDF:",n),n}}typeof window<"u"&&(window.PdfViewerModule={loadPdfViewer:p,exportAnnotations:u,importAnnotations:w,saveAnnotationsToBackend:f,loadAnnotationsFromBackend:h,setupAnnotationAutosave:v,getAnnotationCount:y,goToPage:m,downloadPdfWithAnnotations:F,printPdf:P,PSPDFKit:c});
