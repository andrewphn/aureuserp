import{G as I,p as A}from"./pdfjs-BnRl7pXp.js";import{c as C,d as T,e as d,s as P,g as k,a as R,b as M,f as N,h as V,i as L,j as $,k as D,r as F,l as x,m as S,u as z,n as u,o as O,p as _,q as Z,t as E,z as m,v as B,w as g,x as G,y as H,A as j,B as U,C as K,D as W,E as q,F as J,G as Q,H as X,I as Y,J as ee,K as te,L as ie,M as ae,N as oe,O as se,P as ne,Q as f,R as re,S as le,T as ce,U as de,V as w,W as p,X as he,Y as ue,Z as me,_ as ge,$ as fe,a0 as we,a1 as pe,a2 as ye,a3 as be,a4 as ve,a5 as Ie,a6 as Ae,a7 as Ce,a8 as Te,a9 as Pe,aa as ke,ab as Re,ac as Me,ad as y,ae as Ne,af as Ve,ag as h,ah as Le,ai as $e,aj as De,ak as Fe,al as xe,am as Se,an as ze,ao as Oe,ap as _e,aq as Ze,ar as Ee,as as Be,at as Ge,au as He,av as je,aw as Ue,ax as Ke,ay as We,az as qe,aA as Je,aB as Qe,aC as Xe,aD as Ye,aE as et,aF as tt,aG as it,aH as at,aI as ot,aJ as st,aK as nt,aL as rt,aM as lt,aN as ct}from"./pdf-managers-BEa5ssEN.js";function c(b){return{...C(b),get filteredAnnotations(){return je(this)},get activeFiltersCount(){return He(this)},get activeFilterChips(){return Ge(this)},get availableFilterOptions(){return Be(this)},get filteredPageNumbers(){return Ee(this)},get isolationBreadcrumbs(){return Ze(this)},get availableTypes(){return[...new Set(this.annotations.map(t=>t.type))].sort()},get availableRooms(){const e=new Map;return this.annotations.forEach(t=>{t.roomId&&t.roomName&&e.set(t.roomId,{id:t.roomId,name:t.roomName})}),Array.from(e.values()).sort((t,i)=>t.name.localeCompare(i.name))},get availableLocations(){const e=new Map;return this.annotations.forEach(t=>{t.locationId&&t.locationName&&e.set(t.locationId,{id:t.locationId,name:t.locationName})}),Array.from(e.values()).sort((t,i)=>t.name.localeCompare(i.name))},get availableViewTypes(){return[...new Set(this.annotations.map(t=>t.viewType||"plan"))].sort()},get availableVerticalZones(){return[...new Set(this.annotations.map(t=>t.verticalZone).filter(Boolean))].sort()},get filteredTree(){return this.tree},get visibleAnnotationsList(){return this.annotations.filter(e=>!this.hiddenAnnotations.includes(e.id)&&u(e,this))},async init(){if(this._initialized){console.warn("âš ï¸ PDF Viewer already initialized");return}console.log("ðŸš€ Initializing PDF Annotation Viewer...");try{Se(this),await ze(this,this.$refs,{$nextTick:()=>this.$nextTick()}),await f(this),await h(this,this.$refs),Oe(this),this._cleanupBrowserZoomHandler=_e(this,this.$refs,{updateIsolationMask:()=>w(this)}),this.setupLivewireListeners(),this._initialized=!0,this.systemReady=!0,console.log("âœ“ PDF Viewer initialized successfully")}catch(e){console.error("âŒ PDF Viewer initialization failed:",e),this.error=e.message}},destroy(){console.log("ðŸ§¹ Cleaning up PDF Viewer..."),this._cleanupBrowserZoomHandler&&(this._cleanupBrowserZoomHandler(),this._cleanupBrowserZoomHandler=null),console.log("âœ“ PDF Viewer cleaned up")},setupLivewireListeners(){window.Livewire.on("annotation-created",e=>{console.log("ðŸ“¥ Livewire: annotation-created",e),h(this,this.$refs)}),window.Livewire.on("annotation-updated",e=>{console.log("ðŸ“¥ Livewire: annotation-updated",e),h(this,this.$refs)}),window.Livewire.on("annotation-editor-closed",e=>{console.log("ðŸ“¥ Livewire: annotation-editor-closed",e);const t=this.annotations.length;this.annotations=this.annotations.filter(o=>!o.id.toString().startsWith("temp_"));const i=this.annotations.length;t>i&&console.log(`âœ“ Cleaned up ${t-i} temporary annotation(s)`)}),window.Livewire.on("hierarchy-completed",e=>{console.log("ðŸ“¥ Livewire: hierarchy-completed",e);const{annotation:t,createdIds:i,context:o}=e,a=this.annotations.find(s=>s.id===t.id);if(a){if(i.room&&(a.roomId=i.room),i.room_location&&(a.roomLocationId=i.room_location),i.cabinet_run&&(a.cabinetRunId=i.cabinet_run),i.cabinet&&(a.cabinetSpecId=i.cabinet),console.log("âœ“ Updated annotation with hierarchy:",a),a.parentId){const s=this.annotations.find(n=>n.id===a.parentId);s&&s.type==="location"&&(a.locationId=s.roomLocationId,a.locationName=s.label,console.log("âœ“ Populated locationId from parent:",a.locationId))}if(this.isolationMode){console.log("ðŸ” Checking visibility for newly created annotation in isolation mode");const s=p(a,this);!s&&!this.hiddenAnnotations.includes(a.id)?(this.hiddenAnnotations.push(a.id),console.log(`ðŸ‘ï¸ Hiding newly created annotation ${a.id} (not visible in current isolation)`)):s&&this.hiddenAnnotations.includes(a.id)&&(this.hiddenAnnotations=this.hiddenAnnotations.filter(n=>n!==a.id),console.log(`ðŸ‘ï¸ Showing newly created annotation ${a.id} (visible in current isolation)`))}}o.roomId&&(this.activeRoomId=o.roomId),o.locationId&&(this.activeLocationId=o.locationId),o.cabinetRunId&&(this.activeCabinetRunId=o.cabinetRunId),this.saveAnnotations(!0)})},getCanvasScale(){return xe(this.$refs,this)},pdfToScreen(e,t,i,o){return Fe(e,t,i,o,this.$refs,this)},screenToPdf(e,t){return De(e,t,this.$refs,this)},syncOverlayToCanvas(){$e(this.$refs,this)},getOverlayRect(){return Le(this.$refs,this)},async loadAnnotations(){await h(this,this.$refs)},async saveAnnotations(e=!1){await Ve(this,async()=>{await this.loadAnnotations(),await this.$nextTick(),await this.refreshTree(),await this.$nextTick(),this.syncOverlayToCanvas()},e)},async deleteAnnotation(e){await Ne(e,this,()=>this.refreshTree())},editAnnotation(e){y(e,this)},selectAnnotation(e){y(e,this)},startDrawing(e){Me(e,this,this.$refs)},updateDrawPreview(e){Re(e,this,this.$refs)},finishDrawing(e){ke(e,this,this.$refs)},setDrawMode(e){Pe(e,this,t=>We(t,this),t=>Ke(t))},canDrawLocation(){return Te(this)},canDraw(){return Ce(this)},clearContext(){Ae(this)},getContextLabel(){return Ie(this)},startResize(e,t,i){ve(e,t,i,this)},startMove(e,t){be(e,t,this)},updateDrawing(e){this.updateDrawPreview(e)},cancelDrawing(e){this.isDrawing&&(this.isDrawing=!1,this.drawStart=null,this.drawPreview=null)},handleResize(e){ye(e,this)},handleMove(e){pe(e,this)},finishResizeOrMove(e){we(e,this,this.$refs),this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveAnnotations(!0)},1e3)},selectAnnotationContext(e){e.type==="room"?this.selectNode(e.roomId,"room",e.label||e.name,null,null,null):e.type==="room_location"||e.type==="location"?this.selectNode(e.roomLocationId||e.id,"room_location",e.label||e.name,e.roomId,null,null):e.type==="cabinet_run"?this.selectNode(e.cabinetRunId||e.id,"cabinet_run",e.label||e.name,e.roomId,e.roomLocationId||e.locationId,null):e.type==="cabinet"&&this.selectNode(e.id,"cabinet",e.label||e.name,e.roomId,e.roomLocationId||e.locationId,e.cabinetRunId)},undo(){fe(this)},redo(){ge(this)},canUndo(){return me(this)},canRedo(){return ue(this)},async enterIsolationMode(e){await d(e,this,{zoomToFitAnnotation:t=>m(t,this,this.$refs,this.getCallbacks()),syncOverlayToCanvas:()=>this.syncOverlayToCanvas(),$nextTick:()=>this.$nextTick()})},async exitIsolationMode(){await he(this,{clearContext:()=>this.clearContext(),resetZoom:()=>g(this,this.$refs,this.getCallbacks())})},isAnnotationVisibleInIsolation(e){return p(e,this)},updateIsolationMask(){w(this)},clearAllFilters(){de(this)},removeFilter(e){ce(e,this)},applyPreset(e){le(e,this)},isPresetActive(e){return re(e,this)},hasActiveFilters(){return this.activeFiltersCount>0},async loadTree(){await f(this)},async refreshTree(){await ne(this,{$refs:this.$refs,...this.getCallbacks()})},toggleNode(e){se(e,this)},isExpanded(e){return oe(e,this)},async selectNode(e,t,i,o,a,s){await ae({nodeId:e,type:t,name:i,parentRoomId:o,parentLocationId:a,parentCabinetRunId:s},this,{navigateToNodePage:(n,r,l)=>Ue(n,r,l,this,this.getCallbacks())})},showContextMenu(e,t,i,o,a,s){ie(e,{nodeId:t,nodeType:i,nodeName:o,parentRoomId:a,parentLocationId:s},this)},async deleteTreeNode(){await te(this,()=>this.refreshTree())},async navigateToNodeOnDoubleClick(e,t,i,o){await ee({nodeId:e,nodeType:t,parentRoomId:i,parentLocationId:o},this,{goToPage:a=>this.goToPage(a)})},async nextPage(){await Y(this,this.getCallbacks())},async previousPage(){await X(this,this.getCallbacks())},async goToPage(e){await Q(e,this,this.getCallbacks())},canGoNext(){return J(this,()=>this.filteredPageNumbers)},canGoPrevious(){return q(this,()=>this.filteredPageNumbers)},searchRooms(e){W(e,this)},async selectRoom(e){await K(e,this,()=>this.refreshTree())},searchLocations(e){U(e,this)},async selectLocation(e){await j(e,this,()=>this.refreshTree())},async zoomIn(){await H(this,this.$refs,this.getCallbacks())},async zoomOut(){await G(this,this.$refs,this.getCallbacks())},async resetZoom(){await g(this,this.$refs,this.getCallbacks())},getZoomPercentage(){return B(this)},async zoomToFitAnnotation(e){await m(e,this,this.$refs,this.getCallbacks())},isAtMinZoom(){return E(this)},isAtMaxZoom(){return Z(this)},setViewType(e,t=null){_(e,t,this,{updateAnnotationVisibility:()=>this.updateAnnotationVisibility()})},setOrientation(e){O(e,this,{updateAnnotationVisibility:()=>this.updateAnnotationVisibility()})},isAnnotationVisibleInView(e){return u(e,this)},updateAnnotationVisibility(){z(this)},getCurrentViewLabel(){return S(this)},addEntityReference(e,t,i,o="primary"){x(e,t,i,o,this)},removeEntityReference(e,t,i){F(e,t,i,this)},getEntityReferences(e){return D(e,this)},getReferencesByType(e,t){return $(e,t,this)},hasEntityReference(e,t,i){return L(e,t,i,this)},clearAnnotationReferences(e){V(e,this)},getPageGroupedAnnotations(){return N(this)},getCurrentViewColor(){return M(this)},getLabelPositionClasses(e){return R(e,this.$refs,this)},getButtonPositionClasses(e){return k(e,this.$refs,this)},handleNodeClick(e){this.selectedAnnotation=e,this.activeAnnotationId=e.id,console.log("ðŸ‘† Node clicked:",e.label||e.id,"type:",e.type),P(e,this)},handleAnnotationDoubleClick(e){console.log("ðŸ‘†ðŸ‘† Annotation double-clicked:",e.label||e.id),d(e,this,this.getCallbacks())},handleNodeDoubleClick(e,t,...i){console.log("ðŸ‘†ðŸ‘† Tree node double-clicked:",e,t);let o=null;if(e==="room")o=this.annotations.find(a=>a.type==="room"&&a.roomId===t);else if(e==="room_location"||e==="location"){const[a]=i;o=this.annotations.find(s=>s.type==="location"&&s.roomLocationId===t&&s.roomId===a)}else if(e==="cabinet_run"){const[a,s]=i;o=this.annotations.find(n=>n.type==="cabinet_run"&&n.cabinetRunId===t&&n.roomId===a&&(n.locationId===s||n.roomLocationId===s))}else if(e==="cabinet"){const[a,s,n]=i;o=this.annotations.find(r=>r.type==="cabinet"&&r.id===t)}o?d(o,this,this.getCallbacks()):console.warn("âš ï¸ Could not find annotation to isolate:",e,t)},handleTreeNodeDoubleClick(e,t,i,...o){console.log("ðŸ‘†ðŸ‘† Tree node double-clicked (with label):",e,i,t);let a=null;if(e==="room")a={type:"room",id:t,label:i,roomId:t};else if(e==="location"){const[s,n,r,l]=o;a={type:"location",id:t,label:i,roomId:s,roomName:n,roomLocationId:r||t,locationId:r||t,locationName:l||i}}else if(e==="cabinet_run"){const[s,n,r,l,v]=o;a={type:"cabinet_run",id:t,label:i,roomId:s,roomName:n,locationId:r,roomLocationId:r,locationName:l,cabinetRunId:v||t}}a?d(a,this,this.getCallbacks()):console.warn("âš ï¸ Could not create annotation for isolation:",e,i)},getCallbacks(){return{displayPdf:()=>T(this,this.$refs),loadAnnotations:()=>this.loadAnnotations(),getFilteredPageNumbers:()=>this.filteredPageNumbers,updateIsolationMask:()=>this.updateIsolationMask(),syncOverlayToCanvas:()=>this.syncOverlayToCanvas(),resetZoom:()=>this.resetZoom(),$nextTick:()=>this.$nextTick()}}}}I.workerSrc="/js/pdf.worker.min.js";window.pdfjsLib=A;window.createPdfViewerComponent=c;window.PdfViewerManagers={AnnotationManager:ct,TreeManager:lt,CoordTransform:rt,DrawingSystem:nt,ResizeMoveSystem:st,StateManager:ot,IsolationModeManager:at,VisibilityToggleManager:it,ZoomManager:tt,ViewTypeManager:et,EntityReferenceManager:Ye,FilterSystem:Xe,NavigationManager:Qe,UndoRedoManager:Je,AutocompleteManager:qe};typeof Alpine<"u"?(Alpine.data("annotationSystemV3",c),Alpine.data("annotationSystemV2",c),console.log("âœ… PDF Annotation System loaded - Alpine components registered (V2 + V3)")):document.addEventListener("alpine:init",()=>{Alpine.data("annotationSystemV3",c),Alpine.data("annotationSystemV2",c),console.log("âœ… PDF Annotation System loaded - Alpine components registered (V2 + V3)")});console.log("âœ“ PDF Viewer component loaded and ready");
