import{a as q,C as y,b as j,L as K,P as z,c as V,B as Q,p as W,d as J,e as G,A as Y,T as X,i as Z,M as ee,f as te}from"./vendor-30kCyqeT.js";import"./pdf-viewer-CCqPKvGl.js";import"./pdfjs-BnRl7pXp.js";import"./pdf-managers-BEa5ssEN.js";window.axios=q;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";y.register(j,K,z,V,Q,W,J,G,Y,X,Z);const g={primary:"#D4A574",primaryDark:"#B8935E",success:"#4A7C59",background:"#FDF6EC",text:"#8B6914",border:"#E8DCC4",grid:"rgba(212, 165, 116, 0.1)",accent:"#5B8FA3"};y.defaults.color=g.text;y.defaults.borderColor=g.border;y.defaults.backgroundColor=g.background;const ne={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{boxWidth:20,padding:15,color:g.text,font:{size:14,family:"'Inter', sans-serif",weight:"500"}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",titleFont:{size:16,weight:"600"},bodyFont:{size:14},cornerRadius:8,padding:12,borderColor:g.primary,borderWidth:1}},scales:{y:{grid:{color:g.grid,borderColor:g.border},ticks:{color:g.text,font:{size:12}}},x:{grid:{color:g.grid,borderColor:g.border},ticks:{color:g.text,font:{size:12}}}},elements:{point:{radius:6,hoverRadius:8,borderWidth:2},line:{borderWidth:3,tension:.2},bar:{borderRadius:4,borderSkipped:!1}}},_=[g.primary,g.primaryDark,g.success,g.accent,"#8B9DC3","#DDB892","#7F9F8A","#A0826D"];window.createTcsChart=function(e,i){const r={...i,options:{...ne,...i.options}};return r.data&&r.data.datasets&&r.data.datasets.forEach((c,f)=>{if(!c.backgroundColor&&!c.borderColor){const m=f%_.length,a=_[m];r.type==="line"?(c.borderColor=a,c.backgroundColor=a+"20"):(c.backgroundColor=a,c.borderColor=a)}}),new y(e,r)};window.Chart=y;window.TCS_BRAND_COLORS=g;window.TCS_COLOR_PALETTE=_;window.componentRegistry=window.componentRegistry||{};let A=!1;function E(e,i){window.componentRegistry[e]=i,window[e]=i,!A&&window.location.hostname.includes("localhost")&&console.log(`[ComponentLoader] Registered component: ${e}`)}function x(){Object.keys(window.componentRegistry).forEach(e=>{window[e]=window.componentRegistry[e]}),A||(A=!0,window.location.hostname.includes("localhost")&&console.log("[ComponentLoader] Components registered and ready"))}document.addEventListener("livewire:navigated",x);let L=!1;document.addEventListener("livewire:load",()=>{L||(L=!0,x())});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x):x();function N(e={}){return console.log("[AdvancedFileUpload] Initializing with config:",e),{state:{acceptedFileTypes:e.acceptedFileTypes||["application/pdf"],maxFiles:e.maxFiles||1,maxFileSize:e.maxFileSize||"10MB",pdfPreviewHeight:e.pdfPreviewHeight||400,allowPdfPreview:e.allowPdfPreview!==!1,...e},init(){console.log("[AdvancedFileUpload] Component initialized"),typeof window.FilePond<"u"?this.initializeFilePond():document.addEventListener("FilePond:loaded",()=>{this.initializeFilePond()})},initializeFilePond(){console.log("[AdvancedFileUpload] Initializing FilePond with state:",this.state)}}}E("advancedFileUpload",N);window.advancedFileUpload=N;function k(e={}){return{state:{files:[],isUploading:!1,...e},init(){console.log("[FileUploadFormComponent] Component initialized")}}}function H(e={}){return{state:{value:"",maxLength:null,rows:3,...e},init(){console.log("[TextareaFormComponent] Component initialized")}}}function U(e,i={}){return console.error("[FormComponent Error]",e,i),e}function B(e,i=null){const r=`form_state_${e}`;return window[r]||i}E("fileUploadFormComponent",k);E("textareaFormComponent",H);E("error",U);E("state",B);window.fileUploadFormComponent=k;window.textareaFormComponent=H;window.error=U;window.state=B;function ie({contextType:e=null,contextId:i=null,contextData:r={},contextConfigs:c={},isMinimized:f=!0,hasActiveContext:m=!1}){return{isMinimized:f,hasActiveContext:m,contextType:e,contextId:i,contextData:r,contextConfigs:c,get contextConfig(){return this.contextConfigs[this.contextType]||{name:"Context",emptyLabel:"No Context",borderColor:"rgb(156, 163, 175)",iconPath:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}},init(){this.loadContextFromStorage(),this.setupEventListeners(),this.$watch("contextType",()=>this.saveContextToStorage()),this.$watch("contextId",()=>this.saveContextToStorage())},loadContextFromStorage(){try{const a=sessionStorage.getItem("active_context");if(!a)return;const h=JSON.parse(a);if(h.timestamp&&Date.now()-h.timestamp>864e5){sessionStorage.removeItem("active_context");return}h.entityType&&h.entityId&&(this.hasActiveContext=!0)}catch(a){console.error("[Context Footer] Error loading from storage:",a)}},saveContextToStorage(){this.contextType&&this.contextId?sessionStorage.setItem("active_context",JSON.stringify({entityType:this.contextType,entityId:this.contextId,timestamp:Date.now()})):sessionStorage.removeItem("active_context")},setupEventListeners(){window.addEventListener("entity-updated",a=>{a.detail.entityType===this.contextType&&a.detail.entityId==this.contextId&&(this.contextData=a.detail.data||this.contextData)}),window.addEventListener("active-context-changed",a=>{this.hasActiveContext=!0}),window.addEventListener("active-context-cleared",a=>{this.hasActiveContext=!1,sessionStorage.removeItem("active_context")})},handleContextChange(a){a&&a.entityType&&a.entityId&&(this.contextType=a.entityType,this.contextId=a.entityId,this.hasActiveContext=!0)},handleEntityUpdate(a){a.entityType===this.contextType&&a.entityId==this.contextId&&this.$wire&&this.$wire.loadActiveContext()},getMinimizedPreview(){if(!this.contextData)return"—";switch(this.contextType){case"project":return this.contextData.project_number||"Project";case"sale":return this.contextData.order_number||"Order";case"inventory":return this.contextData.name||"Item";case"production":return this.contextData.job_number||"Job";default:return this.contextConfig.name}},saveCurrentForm(){let a=null;const h=document.querySelectorAll("button");for(const t of h){const n=t.textContent.trim();if(t.type==="submit"&&(n==="Save"||n==="Save changes")&&!t.closest('[x-data*="contextFooter"]')){a=t;break}}if(a||(a=document.querySelector('.fi-form-actions button[type="submit"], .fi-fo-actions button[type="submit"]')),!a){const t=document.querySelector('.fi-sticky button[type="submit"]');t&&!t.closest('[x-data*="contextFooter"]')&&(a=t)}a?a.click():console.error("[Context Footer] Cannot find Filament save button")}}}E("contextFooter",ie);document.addEventListener("alpine:init",()=>{Alpine.store("entityStore",{getEntityKey(e,i=null){return i?`entity_${e}_${i}`:`entity_${e}_new`},getEntity(e,i=null){const r=this.getEntityKey(e,i),c=["stage_id","mountedActions","mountedActionsArguments","mountedActionsData","mountedFormComponentActions","mountedFormComponentActionsArguments","mountedFormComponentActionsData","mountedFormComponentActionsComponents","mountedInfolistActions","mountedInfolistActionsData","defaultTableAction","activeTab","tableFilters","tableSearch","tableSearchQuery","tableSortColumn","tableSortDirection","tableGrouping","tableGroupingDirection","tableColumnSearches","tableRecordsPerPage","_instance","_syncData","_memo","users","project_number","description","notes","content"];try{const f=sessionStorage.getItem(r);if(!f)return null;const m=JSON.parse(f);if(Date.now()-m.timestamp>864e5)return this.clearEntity(e,i),null;const a={};for(const[h,t]of Object.entries(m.data))c.includes(h)||(a[h]=t);return a}catch(f){return console.error("[EntityStore] Failed to retrieve:",f),null}},updateEntity(e,i=null,r={},c=!1){const f=this.getEntityKey(e,i),m=["stage_id","mountedActions","mountedActionsArguments","mountedActionsData","mountedFormComponentActions","mountedFormComponentActionsArguments","mountedFormComponentActionsData","mountedFormComponentActionsComponents","mountedInfolistActions","mountedInfolistActionsData","defaultTableAction","activeTab","tableFilters","tableSearch","tableSearchQuery","tableSortColumn","tableSortDirection","tableGrouping","tableGroupingDirection","tableColumnSearches","tableRecordsPerPage","_instance","_syncData","_memo","users","project_number","description","notes","content"];try{const a=this.getEntity(e,i)||{},h={};for(const[n,o]of Object.entries(r))m.includes(n)||(h[n]=o);const t=this.deepMerge(a,h);return sessionStorage.setItem(f,JSON.stringify({data:t,timestamp:Date.now(),entityType:e,entityId:i})),c||window.dispatchEvent(new CustomEvent("entity-updated",{detail:{entityType:e,entityId:i,data:t}})),t}catch(a){return console.error("[EntityStore] Failed to update:",a),null}},setEntity(e,i=null,r={},c=!1){const f=this.getEntityKey(e,i);try{return sessionStorage.setItem(f,JSON.stringify({data:r,timestamp:Date.now(),entityType:e,entityId:i})),console.log(`[EntityStore] Set ${e}:`,r),c||window.dispatchEvent(new CustomEvent("entity-updated",{detail:{entityType:e,entityId:i,data:r}})),r}catch(m){return console.error("[EntityStore] Failed to set:",m),null}},clearEntity(e,i=null){const r=this.getEntityKey(e,i);sessionStorage.removeItem(r),console.log(`[EntityStore] Cleared ${e}`),window.dispatchEvent(new CustomEvent("entity-cleared",{detail:{entityType:e,entityId:i}}))},clearAll(){const e=Object.keys(sessionStorage).filter(i=>i.startsWith("entity_"));e.forEach(i=>sessionStorage.removeItem(i)),console.log(`[EntityStore] Cleared all entities (${e.length} items)`)},deepMerge(e,i){const r={...e};for(const c in i)i[c]instanceof Object&&c in e?r[c]=this.deepMerge(e[c],i[c]):r[c]=i[c];return r},getEntityField(e,i,r){const c=this.getEntity(e,i);if(!c)return null;const f=r.split(".");let m=c;for(const a of f)if(m&&typeof m=="object"&&a in m)m=m[a];else return null;return m},updateEntityField(e,i,r,c){const f=r.split("."),m={};let a=m;for(let h=0;h<f.length-1;h++)a[f[h]]={},a=a[f[h]];return a[f[f.length-1]]=c,this.updateEntity(e,i,m)},setActiveContext(e,i,r=null,c=!0){try{return sessionStorage.setItem("active_context",JSON.stringify({entityType:e,entityId:i,timestamp:Date.now()})),console.log(`[EntityStore] Set active context: ${e} #${i||"new"}`),r&&this.setEntity(e,i,r,c),window.dispatchEvent(new CustomEvent("active-context-changed",{detail:{entityType:e,entityId:i}})),!0}catch(f){return console.error("[EntityStore] Failed to set active context:",f),!1}},getActiveContext(){try{const e=sessionStorage.getItem("active_context");if(!e)return null;const i=JSON.parse(e);return Date.now()-i.timestamp>864e5?(this.clearActiveContext(),null):i}catch(e){return console.error("[EntityStore] Failed to get active context:",e),null}},clearActiveContext(){try{return sessionStorage.removeItem("active_context"),console.log("[EntityStore] Cleared active context"),window.dispatchEvent(new CustomEvent("active-context-changed",{detail:{entityType:null,entityId:null}})),!0}catch(e){return console.error("[EntityStore] Failed to clear active context:",e),!1}},isActiveContext(e,i){const r=this.getActiveContext();return r?r.entityType===e&&r.entityId===i:!1}})});document.addEventListener("livewire:init",()=>{if(typeof Livewire>"u"){console.warn("[EntityStore] Livewire not available, skipping Livewire integration");return}let e=!1;const i=new Map,r=250,c=["stage_id","mountedActions","mountedActionsArguments","mountedActionsData","mountedFormComponentActions","mountedFormComponentActionsArguments","mountedFormComponentActionsData","mountedFormComponentActionsComponents","mountedInfolistActions","mountedInfolistActionsData","defaultTableAction","activeTab","tableFilters","tableSearch","tableSearchQuery","tableSortColumn","tableSortDirection","tableGrouping","tableGroupingDirection","tableColumnSearches","tableRecordsPerPage","_instance","_syncData","_memo","users"],f=[...c,"description","notes","content"];Livewire.hook("request",({options:m})=>{if(m.body)try{const a=JSON.parse(m.body);a.serverMemo&&a.serverMemo.data&&c.forEach(h=>{delete a.serverMemo.data[h]}),a.updates&&Array.isArray(a.updates)&&(a.updates=a.updates.filter(h=>{var n;const t=((n=h.payload)==null?void 0:n.name)||h.name;return!c.includes(t)})),m.body=JSON.stringify(a)}catch(a){console.debug("[EntityStore] Failed to filter request payload:",a)}}),Livewire.hook("commit",({component:m})=>{var l,p,w,C,b;if(window.location.pathname.includes("/edit")||e)return;const h=(p=(l=m.name)==null?void 0:l.split("\\").pop())==null?void 0:p.replace(/Create|Edit|Resource/g,"").toLowerCase();if(!h)return;const t=((C=(w=m.$wire)==null?void 0:w.record)==null?void 0:C.id)||null,n=`${h}_${t||"new"}`,o=Date.now(),s=i.get(n);if(s&&o-s<r)return;const d=((b=m.$wire)==null?void 0:b.data)||{},u={};for(const[S,v]of Object.entries(d))f.includes(S)||(u[S]=v);Object.keys(u).length>0&&(i.set(n,o),Alpine.store("entityStore").updateEntity(h,t,u,!0))}),window.addEventListener("entity-updated",m=>{if(window.location.pathname.includes("/edit"))return;const{entityType:h,entityId:t,data:n}=m.detail;e=!0;try{Livewire.all().forEach(o=>{var u,l,p,w;const s=(l=(u=o.name)==null?void 0:u.split("\\").pop())==null?void 0:l.replace(/Create|Edit|Resource/g,"").toLowerCase(),d=((w=(p=o.$wire)==null?void 0:p.record)==null?void 0:w.id)||null;if(s===h&&d===t){let C=0;Object.keys(n).forEach(b=>{if(!f.includes(b))try{o.$wire&&o.$wire.data&&o.$wire.data[b]!==void 0?(o.$wire.set("data."+b,n[b]),C++):o.$wire&&o.$wire[b]!==void 0&&(o.$wire.set(b,n[b]),C++)}catch{}}),C>0}})}finally{setTimeout(()=>{e=!1},50)}}),Livewire.on("entity-saved",m=>{const{entityType:a,entityId:h}=m[0]||m;Alpine.store("entityStore").clearEntity(a,h)}),Livewire.on("set-active-context",m=>{const{entityType:a,entityId:h,data:t}=m[0]||m;Alpine.store("entityStore").setActiveContext(a,h,t)})});document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{var r,c,f;if(typeof Livewire>"u"||typeof Alpine>"u"||window.location.pathname.includes("/edit"))return;const i=Livewire.all()[0];if(i&&i.$wire&&i.name){const m=(r=i.name.split("\\").pop())==null?void 0:r.replace(/Create|Edit|Resource/g,"").toLowerCase(),a=((f=(c=i.$wire)==null?void 0:c.record)==null?void 0:f.id)||null;if(m){const h=Alpine.store("entityStore").getEntity(m,a);if(h&&Object.keys(h).length>0){const t=["stage_id","mountedActions","mountedActionsArguments","mountedActionsData","mountedFormComponentActions","mountedFormComponentActionsArguments","mountedFormComponentActionsData","mountedFormComponentActionsComponents","mountedInfolistActions","mountedInfolistActionsData","defaultTableAction","activeTab","tableFilters","tableSearch","tableSearchQuery","tableSortColumn","tableSortDirection","tableGrouping","tableGroupingDirection","tableColumnSearches","tableRecordsPerPage","_instance","_syncData","_memo","users","project_number","description","notes","content"];let n=0;Object.keys(h).forEach(o=>{if(!t.includes(o))try{i.$wire&&i.$wire.data&&i.$wire.data[o]!==void 0?(i.$wire.set("data."+o,h[o]),n++):i.$wire&&i.$wire[o]!==void 0&&(i.$wire.set(o,h[o]),n++)}catch{}})}}}},500)});window.updateEntityData=function(e,i,r,c=!1){return Alpine.store("entityStore").updateEntity(e,i,r,c)};window.getEntityData=function(e,i){return Alpine.store("entityStore").getEntity(e,i)};window.updateEntityField=function(e,i,r,c){return Alpine.store("entityStore").updateEntityField(e,i,r,c)};window.getEntityField=function(e,i,r){return Alpine.store("entityStore").getEntityField(e,i,r)};window.setActiveContext=function(e,i,r=null,c=!0){return Alpine.store("entityStore").setActiveContext(e,i,r,c)};window.getActiveContext=function(){return Alpine.store("entityStore").getActiveContext()};window.clearActiveContext=function(){return Alpine.store("entityStore").clearActiveContext()};document.addEventListener("alpine:init",()=>{window.addEventListener("active-context-changed",async e=>{const{entityType:i,entityId:r}=e.detail;i==="project"&&r&&await F(r)}),setTimeout(()=>{const e=Alpine.store("entityStore").getActiveContext();e&&e.entityType==="project"&&F(e.entityId)},1e3)});async function F(e){try{if(window.location.pathname.includes("/project/projects/")&&window.location.pathname.includes("/edit")){console.log("[FormAutoPopulate] Skipped - on project edit page");return}const i=await fetch(`/api/projects/${e}`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(!i.ok){console.warn("[FormAutoPopulate] Failed to fetch project details:",i.status);return}const r=await i.json();console.log("[FormAutoPopulate] Loaded project:",r),await new Promise(c=>setTimeout(c,500)),Livewire.all().forEach(c=>{oe(c,r)}),window.dispatchEvent(new CustomEvent("project-context-loaded",{detail:{project:r}}))}catch(i){console.error("[FormAutoPopulate] Error:",i)}}function oe(e,i){if(!e.$wire)return;const r=e.$wire;if(r.record&&r.record.id===i.id){console.log("[FormAutoPopulate] Skipped - component already editing this project");return}const c={"data.project_id":i.id,project_id:i.id,"data.customer_id":i.customer_id,customer_id:i.customer_id,"data.partner_id":i.customer_id,partner_id:i.customer_id,"data.location":i.location,location:i.location,"data.project_name":i.name,project_name:i.name};let f=!1;Object.entries(c).forEach(([m,a])=>{if(a!=null)try{const h=m.split(".");let t=r;for(let o=0;o<h.length-1;o++){if(t[h[o]]===void 0)return;t=t[h[o]]}const n=h[h.length-1];t[n]!==void 0&&(t[n]===null||t[n]===""||t[n]===void 0)&&(r.set(m,a),f=!0,console.log(`[FormAutoPopulate] Set ${m} = ${a}`))}catch{}}),f&&console.log("[FormAutoPopulate] Auto-populated form fields from project context")}window.populateFormFromActiveProject=async function(){const e=Alpine.store("entityStore").getActiveContext();return e&&e.entityType==="project"?(await F(e.entityId),!0):(console.warn("[FormAutoPopulate] No active project context"),!1)};window.setActiveProjectAndPopulate=async function(e){return Alpine.store("entityStore").setActiveContext("project",e),await F(e),!0};window.MeasurementFormatter={settings:{displayUnit:"imperial_decimal",fractionPrecision:8,showUnitSymbol:!0,metricPrecision:0,linearFeetPrecision:2,inputStep:.125},INCHES_TO_MM:25.4,INCHES_TO_CM:2.54,INCHES_TO_M:.0254,INCHES_TO_FEET:1/12,FEET_TO_INCHES:12,INCHES_TO_YARDS:1/36,YARDS_TO_INCHES:36,SQ_INCHES_TO_SQ_FEET:1/144,SQ_FEET_TO_SQ_INCHES:144,CUBIC_INCHES_TO_CUBIC_FEET:1/1728,CUBIC_FEET_TO_CUBIC_INCHES:1728,init(e){e&&(this.settings={...this.settings,...e})},format(e,i=null){if(e==null||isNaN(e))return"-";switch(e=parseFloat(e),i=i??this.settings.showUnitSymbol,this.settings.displayUnit){case"imperial_fraction":return this.formatFraction(e,i);case"metric":return this.formatMetric(e,i);default:return this.formatDecimal(e,i)}},formatDecimal(e,i=!0){let r=e.toFixed(2).replace(/\.?0+$/,"");return i?r+'"':r},formatFraction(e,i=!0){const r=this.settings.fractionPrecision,c=Math.floor(e),f=e-c;if(Math.abs(f)<.001)return i?c+'"':String(c);let m=Math.round(f*r);if(m===0)return i?c+'"':String(c);if(m===r)return i?c+1+'"':String(c+1);const a=this.reduceFraction(m,r),h=c>0?`${c} ${a}`:a;return i?h+'"':h},formatMetric(e,i=!0){const c=(e*this.INCHES_TO_MM).toFixed(this.settings.metricPrecision);return i?c+" mm":c},formatDimensions(e,i,r=null){const c=[this.format(e,!1)+'"W',this.format(i,!1)+'"H'];return r!=null&&c.push(this.format(r,!1)+'"D'),c.join(" x ")},formatLinearFeet(e){const i=this.settings.linearFeetPrecision;return e.toFixed(i)+" LF"},inchesToMm(e){return e*this.INCHES_TO_MM},mmToInches(e){return e/this.INCHES_TO_MM},inchesToFeet(e){return e*this.INCHES_TO_FEET},feetToInches(e){return e*this.FEET_TO_INCHES},inchesToCm(e){return e*this.INCHES_TO_CM},cmToInches(e){return e/this.INCHES_TO_CM},inchesToMeters(e){return e*this.INCHES_TO_M},metersToInches(e){return e/this.INCHES_TO_M},inchesToYards(e){return e*this.INCHES_TO_YARDS},yardsToInches(e){return e*this.YARDS_TO_INCHES},sqInchesToSqFeet(e){return e*this.SQ_INCHES_TO_SQ_FEET},sqFeetToSqInches(e){return e*this.SQ_FEET_TO_SQ_INCHES},calculateSquareFeet(e,i){const r=e*i;return this.sqInchesToSqFeet(r)},cubicInchesToCubicFeet(e){return e*this.CUBIC_INCHES_TO_CUBIC_FEET},cubicFeetToCubicInches(e){return e*this.CUBIC_FEET_TO_CUBIC_INCHES},calculateCubicFeet(e,i,r){const c=e*i*r;return this.cubicInchesToCubicFeet(c)},calculateLinearFeet(e){return this.inchesToFeet(e)},formatSquareFeet(e,i=2){return e.toFixed(i)+" sq ft"},formatCubicFeet(e,i=2){return e.toFixed(i)+" cu ft"},reduceFraction(e,i){const r=this.gcd(e,i);return`${e/r}/${i/r}`},gcd(e,i){return i===0?e:this.gcd(i,e%i)},getInputStep(){return this.settings.inputStep},isFractionMode(){return this.settings.displayUnit==="imperial_fraction"},isMetricMode(){return this.settings.displayUnit==="metric"}};let O=!1;document.addEventListener("alpine:init",()=>{O||(O=!0,Alpine.magic("dimension",()=>(e,i=null)=>MeasurementFormatter.format(e,i)),Alpine.magic("dimensions",()=>(e,i,r=null)=>MeasurementFormatter.formatDimensions(e,i,r)),Alpine.magic("linearFeet",()=>e=>MeasurementFormatter.formatLinearFeet(e)),Alpine.magic("measurementSettings",()=>MeasurementFormatter.settings))},{once:!0});window.formatDimension=(e,i=null)=>MeasurementFormatter.format(e,i);window.formatDimensions=(e,i,r=null)=>MeasurementFormatter.formatDimensions(e,i,r);window.formatLinearFeet=e=>MeasurementFormatter.formatLinearFeet(e);function re(e,i,r,c,f,m,a,h){return{specData:e,expanded:i,isAddingCabinet:r||!1,newCabinetData:c||{},pricingTiers:f||{},materialOptions:m||{},finishOptions:a||{},sidebarCollapsed:!1,showKeyboardHelp:!1,selectedRoomIndex:null,selectedRoom:null,selectedLocationIndex:null,selectedLocation:null,selectedRunIndex:null,selectedRun:null,selectedCabinetIndex:null,editingRow:null,editingField:null,isAddingCabinet:!1,newCabinetData:{},validationErrors:{},isLoading:!1,virtualScroll:{enabled:!1,threshold:50,rowHeight:48,visibleStart:0,visibleEnd:20,bufferSize:5,containerHeight:400,scrollTop:0},fieldOrder:["name","length_inches","height_inches","depth_inches","quantity"],init(){window.MeasurementFormatter&&h&&window.MeasurementFormatter.init(h),this.$watch("specData",t=>{var n,o;this.selectedRoomIndex!==null&&t[this.selectedRoomIndex]&&(this.selectedRoom=t[this.selectedRoomIndex],this.selectedLocationIndex!==null&&((n=this.selectedRoom.children)!=null&&n[this.selectedLocationIndex])&&(this.selectedLocation=this.selectedRoom.children[this.selectedLocationIndex],this.selectedRunIndex!==null&&((o=this.selectedLocation.children)!=null&&o[this.selectedRunIndex])&&(this.selectedRun=this.selectedLocation.children[this.selectedRunIndex])))}),this.specData&&this.specData.length>0&&this.selectRoom(0),this.setupKeyboardShortcuts()},announceToScreenReader(t,n="polite"){var u,l;const o=((u=this.$refs)==null?void 0:u.announcements)||document.getElementById("cabinet-table-announcements"),s=((l=this.$refs)==null?void 0:l.globalAnnouncements)||document.getElementById("global-announcements"),d=o||s;d&&(d.setAttribute("aria-live",n),d.textContent="",setTimeout(()=>{d.textContent=t},50))},announceValidationError(t,n){const s={name:"cabinet name",length_inches:"width",height_inches:"height",depth_inches:"depth",quantity:"quantity"}[t]||t;this.announceToScreenReader(`Error in ${s}: ${n}`,"assertive")},announceSuccess(t){this.announceToScreenReader(t,"polite")},setupKeyboardShortcuts(){document.addEventListener("keydown",t=>{if((t.ctrlKey||t.metaKey)&&(t.key==="?"||t.shiftKey&&t.key==="/")){t.preventDefault(),this.showKeyboardHelp=!this.showKeyboardHelp,this.showKeyboardHelp&&this.announceToScreenReader("Keyboard shortcuts dialog opened");return}if(t.key==="F2"&&this.selectedRun&&!this.isAddingCabinet&&this.editingRow===null){t.preventDefault(),(this.selectedRun.children||[]).length>0&&(this.startEdit(0,this.fieldOrder[0]),this.announceToScreenReader("Editing cabinet name"));return}this.editingRow!==null&&!this.isAddingCabinet&&this.handleArrowNavigation(t)})},handleArrowNavigation(t){var o;const n=((o=this.selectedRun)==null?void 0:o.children)||[];if(n.length!==0)switch(t.key){case"ArrowRight":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.startEdit(this.editingRow,this.fieldOrder[this.fieldOrder.length-1]),this.announceToScreenReader(`Moved to ${this.fieldOrder[this.fieldOrder.length-1]}`));break;case"ArrowLeft":(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this.startEdit(this.editingRow,this.fieldOrder[0]),this.announceToScreenReader(`Moved to ${this.fieldOrder[0]}`));break;case"ArrowUp":if(!t.shiftKey){t.preventDefault();const s=this.editingRow-1;s>=0&&(this.startEdit(s,this.editingField),this.announceToScreenReader(`Row ${s+1} of ${n.length}`))}break;case"ArrowDown":if(!t.shiftKey){t.preventDefault();const s=this.editingRow+1;s<n.length&&(this.startEdit(s,this.editingField),this.announceToScreenReader(`Row ${s+1} of ${n.length}`))}break;case"Home":t.ctrlKey||t.metaKey?(t.preventDefault(),this.startEdit(0,this.fieldOrder[0]),this.announceToScreenReader("First cell of table")):(t.preventDefault(),this.startEdit(this.editingRow,this.fieldOrder[0]),this.announceToScreenReader("First cell of row"));break;case"End":if(t.ctrlKey||t.metaKey){t.preventDefault();const s=n.length-1;this.startEdit(s,this.fieldOrder[this.fieldOrder.length-1]),this.announceToScreenReader("Last cell of table")}else t.preventDefault(),this.startEdit(this.editingRow,this.fieldOrder[this.fieldOrder.length-1]),this.announceToScreenReader("Last cell of row");break}},selectRoom(t){const n=this.specData[t];n&&(this.selectedRoomIndex=t,this.selectedRoom=n,this.selectedLocationIndex=null,this.selectedLocation=null,this.selectedRunIndex=null,this.selectedRun=null,n.id&&!this.expanded.includes(n.id)&&this.expanded.push(n.id),this.announceToScreenReader(`Selected room: ${n.name||"Unnamed room"}`))},selectLocation(t,n){var s,d;this.selectedRoomIndex!==t&&this.selectRoom(t);const o=(d=(s=this.specData[t])==null?void 0:s.children)==null?void 0:d[n];o&&(this.selectedLocationIndex=n,this.selectedLocation=o,this.selectedRunIndex=null,this.selectedRun=null,o.id&&!this.expanded.includes(o.id)&&this.expanded.push(o.id),this.announceToScreenReader(`Selected location: ${o.name||"Unnamed location"}`))},selectRun(t,n,o){var u,l,p,w;(this.selectedRoomIndex!==t||this.selectedLocationIndex!==n)&&this.selectLocation(t,n);const s=(w=(p=(l=(u=this.specData[t])==null?void 0:u.children)==null?void 0:l[n])==null?void 0:p.children)==null?void 0:w[o];if(!s)return;this.selectedRunIndex=o,this.selectedRun=s,this.selectedCabinetIndex=null;const d=(s.children||[]).length;this.announceToScreenReader(`Selected run: ${s.name||"Unnamed run"}. Contains ${d} cabinet${d!==1?"s":""}.`)},toggleAccordion(t){const n=this.expanded.indexOf(t);n>-1?(this.expanded.splice(n,1),this.announceToScreenReader("Section collapsed")):(this.expanded.push(t),this.announceToScreenReader("Section expanded"))},isExpanded(t){return this.expanded.includes(t)},clearToRoom(){this.selectedLocationIndex=null,this.selectedLocation=null,this.selectedRunIndex=null,this.selectedRun=null,this.announceToScreenReader("Navigated back to room level")},clearToLocation(){this.selectedRunIndex=null,this.selectedRun=null,this.announceToScreenReader("Navigated back to location level")},getPricePerLF(t="3",n="stain_grade",o="unfinished"){let s=192;const u=(this.pricingTiers[t]||"").match(/\$(\d+(?:\.\d+)?)/);u?s=parseFloat(u[1]):s={1:138,2:168,3:192,4:242,5:345}[t]||192;let l=0;const w=(this.materialOptions[n]||"").match(/\+\$(\d+(?:\.\d+)?)/);w?l=parseFloat(w[1]):n==="stain_grade"&&(l=156);let C=0;const S=(this.finishOptions[o]||"").match(/\+\$(\d+(?:\.\d+)?)/);return S&&(C=parseFloat(S[1])),s+l+C},updateLocationPricing(t,n){if(this.selectedLocationIndex===null)return;this.selectedLocation[t]=n||null;const o=`${this.selectedRoomIndex}.children.${this.selectedLocationIndex}`;this.$wire.updateNodeField(o,{[t]:n||null})},updateRoomPricing(t,n){if(this.selectedRoomIndex===null)return;this.selectedRoom[t]=n;const o=`${this.selectedRoomIndex}`;this.$wire.updateNodeField(o,{[t]:n})},updateRunPricing(t,n){if(this.selectedRunIndex===null)return;this.selectedRun[t]=n||null;const o=`${this.selectedRoomIndex}.children.${this.selectedLocationIndex}.children.${this.selectedRunIndex}`;this.$wire.updateNodeField(o,{[t]:n||null})},addCabinetFromCode(t){if(!t||!this.selectedRun)return;t=t.trim().toUpperCase();const n=this.parseCabinetCode(t);if(!n.width){this.announceValidationError("code","Invalid cabinet code format");return}const o=`${this.selectedRoomIndex}.children.${this.selectedLocationIndex}.children.${this.selectedRunIndex}`;this.$wire.handleAiAddCabinet({run_path:o,name:t,cabinet_type:n.type,length_inches:n.width,depth_inches:n.depth,height_inches:n.height,quantity:1,source:"user"}),this.announceSuccess(`Added cabinet ${t}`)},parseCabinetCode(t){var d,u;const n={base:{depth:24,height:34.5},wall:{depth:12,height:30},tall:{depth:24,height:84},vanity:{depth:21,height:34.5},sink_base:{depth:24,height:34.5}};let o="base",s=null;return/^(SB|BBC)(\d+)$/.test(t)?(o="sink_base",s=parseInt(t.match(/(\d+)$/)[1])):/^(DB|B)(\d+)$/.test(t)?(o="base",s=parseInt(t.match(/(\d+)$/)[1])):/^W(\d+)/.test(t)?(o="wall",s=parseInt(t.match(/^W(\d+)/)[1])):/^(T|TP|P)(\d+)$/.test(t)?(o="tall",s=parseInt(t.match(/(\d+)$/)[1])):/^V(\d+)$/.test(t)?(o="vanity",s=parseInt(t.match(/(\d+)$/)[1])):/^\d+$/.test(t)&&(o="base",s=parseInt(t)),{type:o,width:s,depth:((d=n[o])==null?void 0:d.depth)||24,height:((u=n[o])==null?void 0:u.height)||34.5}},startEdit(t,n){var s,d;this.editingRow=t,this.editingField=n,this.validationErrors={};const o=(d=(s=this.selectedRun)==null?void 0:s.children)==null?void 0:d[t];if(o){const u={name:"name",length_inches:"width",height_inches:"height",depth_inches:"depth",quantity:"quantity"};this.announceToScreenReader(`Editing ${u[n]||n} for cabinet ${o.name||"unnamed"}`)}},handleF2Edit(t){t.key==="F2"&&this.selectedRun&&this.selectedRun.children&&(t.preventDefault(),this.selectedRun.children[0]&&this.startEdit(0,this.fieldOrder[0]))},cancelEdit(){this.editingRow=null,this.editingField=null,this.validationErrors={},this.announceToScreenReader("Edit cancelled")},validateField(t,n){if(["length_inches","height_inches","depth_inches"].includes(t)){const o=parseFloat(n);if(isNaN(o))return"Please enter a valid number";if(o<=0)return"Value must be greater than 0";if(o>120)return"Value seems too large (max 120 inches)"}else if(t==="quantity"){const o=parseInt(n);if(isNaN(o))return"Please enter a valid number";if(o<1)return"Quantity must be at least 1";if(o>100)return"Quantity seems too large (max 100)"}return null},saveCabinetField(t,n,o){var p;if(!this.selectedRun||!((p=this.selectedRun.children)!=null&&p[t]))return;const s=this.selectedRun.children[t],d=s[n],u=this.validateField(n,o);if(u){this.validationErrors[n]=u,this.announceValidationError(n,u);return}if(delete this.validationErrors[n],["length_inches","height_inches","depth_inches"].includes(n)?o=parseFloat(o):n==="quantity"&&(o=parseInt(o)),o===d){this.cancelEdit();return}s[n]=o;const l=`${this.selectedRoomIndex}.children.${this.selectedLocationIndex}.children.${this.selectedRunIndex}.children.${t}`;this.$wire.updateCabinetField(l,n,o),this.announceSuccess(`Updated ${n.replace("_"," ")} to ${o}`),this.cancelEdit()},moveToNextCell(t,n,o=null){o&&o.preventDefault();const d=this.fieldOrder.indexOf(n)+1;d<this.fieldOrder.length?this.$nextTick(()=>{this.startEdit(t,this.fieldOrder[d])}):this.moveToNextRow(t,o)},moveToPreviousCell(t,n,o=null){o&&o.preventDefault();const d=this.fieldOrder.indexOf(n)-1;if(d>=0)this.$nextTick(()=>{this.startEdit(t,this.fieldOrder[d])});else{const u=t-1;u>=0&&this.$nextTick(()=>{this.startEdit(u,this.fieldOrder[this.fieldOrder.length-1])})}},moveToNextRow(t,n=null){var d;n&&n.preventDefault();const o=((d=this.selectedRun)==null?void 0:d.children)||[],s=t+1;s<o.length?this.$nextTick(()=>{this.startEdit(s,this.fieldOrder[0])}):(this.cancelEdit(),this.$nextTick(()=>{var u;(u=this.$refs.quickAddInput)==null||u.focus()}))},deleteCabinet(t){var d;if(!this.selectedRun)return;const n=(d=this.selectedRun.children)==null?void 0:d[t],o=(n==null?void 0:n.name)||"cabinet",s=`${this.selectedRoomIndex}.children.${this.selectedLocationIndex}.children.${this.selectedRunIndex}.children.${t}`;this.$wire.deleteCabinetByPath(s),this.announceSuccess(`Deleted ${o}`)},saveInlineCabinet(t=!1){var d,u;if(!this.selectedRun)return;`${this.selectedRoomIndex}${this.selectedLocationIndex}${this.selectedRunIndex}`;const n=(((d=this.newCabinetData)==null?void 0:d.name)||"").trim(),o=!!((u=this.newCabinetData)!=null&&u.length_inches);if(!n&&!o){this.announceValidationError("name","Enter a cabinet code or width");return}const s={};if(this.newCabinetData.length_inches){const l=this.validateField("length_inches",this.newCabinetData.length_inches);l&&(s.length_inches=l)}if(this.newCabinetData.height_inches){const l=this.validateField("height_inches",this.newCabinetData.height_inches);l&&(s.height_inches=l)}if(this.newCabinetData.depth_inches){const l=this.validateField("depth_inches",this.newCabinetData.depth_inches);l&&(s.depth_inches=l)}if(this.newCabinetData.quantity){const l=this.validateField("quantity",this.newCabinetData.quantity);l&&(s.quantity=l)}if(Object.keys(s).length>0){this.validationErrors=s;const l=Object.entries(s)[0];this.announceValidationError(l[0],l[1]);return}this.validationErrors={},this.newCabinetData.quantity||(this.newCabinetData.quantity=1),this.isLoading=!0,this.$wire.saveCabinet(t).then(()=>{this.isLoading=!1;const l=this.newCabinetData.name||"Cabinet";this.announceSuccess(`Added ${l}`),t?this.announceToScreenReader("Ready to add another cabinet"):this.newCabinetData={}}).catch(()=>{this.isLoading=!1,this.announceValidationError("save","Failed to save cabinet")})},cancelInlineAdd(){this.$wire.cancelAdd(),this.newCabinetData={},this.validationErrors={},this.announceToScreenReader("Cancelled adding cabinet")},focusNextField(t){this.$nextTick(()=>{const n=document.querySelector(`input[x-model="newCabinetData.${t}"]`);if(n){n.focus(),n.type==="number"&&n.select();const o={length_inches:"width",height_inches:"height",depth_inches:"depth",quantity:"quantity"};this.announceToScreenReader(`Now editing ${o[t]||t}`)}})},formatDimension(t){return t?window.MeasurementFormatter&&window.MeasurementFormatter.format?window.MeasurementFormatter.format(t,"inches"):`${t}"`:"-"},formatLinearFeet(t){return t?window.MeasurementFormatter&&window.MeasurementFormatter.formatLinearFeet?window.MeasurementFormatter.formatLinearFeet(t):`${parseFloat(t).toFixed(2)} LF`:"0.00 LF"},formatDimensions(t,n,o){if(!t||!n||!o)return"-";const s=this.formatDimension(t),d=this.formatDimension(n),u=this.formatDimension(o);return`${s} × ${d} × ${u}`},shouldUseVirtualScroll(){var n;return(((n=this.selectedRun)==null?void 0:n.children)||[]).length>this.virtualScroll.threshold},getVisibleCabinets(){var l;const t=((l=this.selectedRun)==null?void 0:l.children)||[];if(!this.shouldUseVirtualScroll())return t;const{visibleStart:n,visibleEnd:o,bufferSize:s}=this.virtualScroll,d=Math.max(0,n-s),u=Math.min(t.length,o+s);return t.slice(d,u)},getActualCabinetIndex(t){if(!this.shouldUseVirtualScroll())return t;const n=this.virtualScroll.bufferSize;return Math.max(0,this.virtualScroll.visibleStart-n)+t},handleVirtualScroll(t){if(!this.shouldUseVirtualScroll())return;const n=t.target.scrollTop,{rowHeight:o,containerHeight:s,bufferSize:d}=this.virtualScroll;this.virtualScroll.scrollTop=n,this.virtualScroll.visibleStart=Math.floor(n/o),this.virtualScroll.visibleEnd=Math.ceil((n+s)/o)},getVirtualScrollHeight(){var n;return this.shouldUseVirtualScroll()?(((n=this.selectedRun)==null?void 0:n.children)||[]).length*this.virtualScroll.rowHeight:0},getVirtualScrollOffset(){if(!this.shouldUseVirtualScroll())return 0;const{visibleStart:t,bufferSize:n,rowHeight:o}=this.virtualScroll;return Math.max(0,t-n)*o},scrollToCabinet(t){if(!this.shouldUseVirtualScroll())return;const{rowHeight:n,containerHeight:o}=this.virtualScroll,s=t*n-o/2,d=this.$el.querySelector(".cabinet-table-container");d&&d.scrollTo({top:Math.max(0,s),behavior:"smooth"})},initVirtualScroll(){const t=this.$el.querySelector(".cabinet-table-container");if(t){this.virtualScroll.containerHeight=t.clientHeight;const{rowHeight:n,containerHeight:o,bufferSize:s}=this.virtualScroll;this.virtualScroll.visibleEnd=Math.ceil(o/n)+s}},contextMenu:{show:!1,x:0,y:0,type:null,roomIdx:null,locIdx:null,runIdx:null},openContextMenu(t,n,o,s,d){var w,C,b,S,v,T,R,I,$,D;let u,l,p;n==="room"?(u=this.specData[o],l=this.specData,p=o):n==="location"?(u=(C=(w=this.specData[o])==null?void 0:w.children)==null?void 0:C[s],l=((b=this.specData[o])==null?void 0:b.children)||[],p=s):n==="run"&&(u=(R=(T=(v=(S=this.specData[o])==null?void 0:S.children)==null?void 0:v[s])==null?void 0:T.children)==null?void 0:R[d],l=((D=($=(I=this.specData[o])==null?void 0:I.children)==null?void 0:$[s])==null?void 0:D.children)||[],p=d),this.contextMenu={show:!0,x:t.clientX,y:t.clientY,type:n,roomIdx:o,locIdx:s,runIdx:d,nodeName:(u==null?void 0:u.name)||"Item",isFirst:p===0,isLast:p===l.length-1,childType:n==="room"?"Location":n==="location"?"Run":"Cabinet"},this.announceToScreenReader(`Context menu opened for ${(u==null?void 0:u.name)||n}. Use arrow keys to navigate, Enter to select.`),setTimeout(()=>{document.addEventListener("click",this.closeContextMenu.bind(this),{once:!0})},0)},closeContextMenu(){this.contextMenu.show=!1},contextMenuAction(t){const{type:n,roomIdx:o,locIdx:s,runIdx:d,nodeName:u}=this.contextMenu;let l;switch(n==="room"?l=o.toString():n==="location"?l=`${o}.children.${s}`:n==="run"&&(l=`${o}.children.${s}.children.${d}`),t){case"edit":this.$wire.mountAction("editNode",{nodePath:l}),this.announceToScreenReader(`Opening editor for ${u}`);break;case"duplicate":this.$wire.mountAction("duplicateNode",{nodePath:l,nodeType:n==="location"?"room_location":n==="run"?"cabinet_run":n}),this.announceSuccess(`Duplicated ${u}`);break;case"moveUp":this.$wire.moveNode(l,"up"),this.announceSuccess(`Moved ${u} up`);break;case"moveDown":this.$wire.moveNode(l,"down"),this.announceSuccess(`Moved ${u} down`);break;case"addChild":n==="room"?this.$wire.mountAction("createLocation",{roomPath:l}):n==="location"?this.$wire.mountAction("createRun",{locationPath:l}):n==="run"&&this.$wire.mountAction("createCabinet",{runPath:l});break;case"delete":this.$wire.mountAction("deleteNode",{nodePath:l,nodeType:n==="location"?"room_location":n==="run"?"cabinet_run":n});break}this.closeContextMenu()}}}let M=!1;function P(){M||typeof Alpine<"u"&&!Alpine.data("specAccordionBuilder")&&(Alpine.data("specAccordionBuilder",re),M=!0,window.location.hostname.includes("localhost")&&console.log("✅ Cabinet Spec Builder Alpine component registered (with accessibility features)"))}typeof Alpine<"u"?P():document.addEventListener("alpine:init",P,{once:!0});window.Masonry=ee;window.imagesLoaded=te;x();window.location.hostname.includes("localhost")&&console.log("[App.js] TCS Woodwork ERP - Alpine.js initialization complete with Livewire support");
