@import "tailwindcss";
@variant dark (&:where(.dark, .dark *));

@source '../../../../app/Filament';
@source '../../resources/views';

.fi-fo-table-repeater {
    @apply grid gap-3;

    /* Add scrolling directly to the table repeater container */
    @apply overflow-x-auto;
    
    /* Custom scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: rgb(156 163 175) transparent;
    
    &::-webkit-scrollbar {
        height: 8px;
    }
    
    &::-webkit-scrollbar-track {
        @apply bg-gray-100 dark:bg-gray-800;
    }
    
    &::-webkit-scrollbar-thumb {
        @apply bg-gray-400 rounded dark:bg-gray-600;
    }
    
    &::-webkit-scrollbar-thumb:hover {
        @apply bg-gray-500 dark:bg-gray-500;
    }

    & > table {
        @apply block w-full bg-white divide-y divide-gray-200 shadow-sm rounded-xl ring-1 ring-gray-950/5 dark:divide-white/10 dark:bg-gray-900 dark:ring-white/10;

        & > thead {
            @apply hidden whitespace-nowrap;

            & > tr {
                & > th {
                    @apply border-gray-200 bg-gray-50 px-3 py-2 text-sm font-semibold text-gray-950 first-of-type:rounded-tl-xl last-of-type:rounded-tr-xl dark:border-white/5 dark:bg-white/5 dark:text-white [&:not(:first-of-type)]:border-s [&:not(:last-of-type)]:border-e;

                    &.fi-align-start,
                    &.fi-align-left {
                        @apply text-start;
                    }

                    &.fi-align-end,
                    &.fi-align-right {
                        @apply text-end;
                    }

                    &.fi-wrapped {
                        @apply whitespace-normal;
                    }

                    &:not(.fi-wrapped) {
                        @apply whitespace-nowrap;
                    }

                    &.fi-fo-table-repeater-empty-header-cell {
                        @apply w-1;
                    }
                }
            }
        }

        & > tbody {
            @apply block divide-y divide-gray-200 dark:divide-white/5;

            & > tr {
                @apply grid gap-6 p-6;

                & > td {
                    @apply block;

                    &.fi-hidden {
                        @apply hidden;
                    }
                }
            }
        }

        & .fi-fo-table-repeater-header-required-mark {
            @apply font-medium text-red-600 dark:text-red-400;
        }

        & .fi-fo-table-repeater-actions {
            @apply flex items-center h-full gap-x-3;
        }
    }

    @supports (container-type: inline-size) {
        @apply @container;

        & > table {
            @apply @xl:table @xl:table-fixed @xl:min-w-full;

            & > thead {
                @apply @xl:table-header-group;
                
                & > tr {
                    & > th {
                        /* Make actions column sticky */
                        &:last-child {
                            @apply @xl:sticky @xl:right-0 @xl:z-10 @xl:bg-gray-50 @xl:dark:bg-white/5;
                            box-shadow: -2px 0 8px -2px rgba(0, 0, 0, 0.1);
                        }
                        
                        /* Ensure other columns have minimum width */
                        &:not(:last-child) {
                            @apply @xl:min-w-[150px];
                        }
                    }
                }
            }

            & > tbody {
                @apply @xl:table-row-group;

                & > tr {
                    @apply @xl:table-row @xl:p-0;

                    & > td {
                        @apply @xl:table-cell @xl:px-3 @xl:py-2;

                        &.fi-hidden {
                            @apply @xl:table-cell;
                        }

                        /* Make actions column sticky */
                        &:last-child {
                            @apply @xl:sticky @xl:right-0 @xl:z-10 @xl:bg-white @xl:dark:bg-gray-900;
                            box-shadow: -2px 0 8px -2px rgba(0, 0, 0, 0.1);
                        }

                        /* Ensure data columns take full available width */
                        &:not(:last-child):not(.fi-fo-table-repeater-empty-header-cell) {
                            @apply @xl:min-w-[150px] @xl:max-w-none;
                        }

                        & .fi-fo-field {
                            @apply @xl:gap-y-0;
                        }

                        & .fi-in-entry {
                            @apply @xl:gap-y-0;
                        }

                        & .fi-fo-field-label-content {
                            @apply @xl:hidden;
                        }

                        & .fi-in-entry-label-content {
                            @apply @xl:hidden;
                        }
                    }
                }
            }

            & .fi-fo-table-repeater-actions {
                @apply @xl:px-3 @xl:py-2;
            }
        }
    }

    @supports not (container-type: inline-size) {
        & > table {
            @apply lg:table lg:table-fixed lg:min-w-full;

            & > thead {
                @apply lg:table-header-group;
                
                & > tr {
                    & > th {
                        /* Make actions column sticky */
                        &:last-child {
                            @apply lg:sticky lg:right-0 lg:z-10 lg:bg-gray-50 lg:dark:bg-white/5;
                            box-shadow: -2px 0 8px -2px rgba(0, 0, 0, 0.1);
                        }
                        
                        /* Ensure other columns have minimum width */
                        &:not(:last-child) {
                            @apply lg:min-w-[150px];
                        }
                    }
                }
            }

            & > tbody {
                @apply lg:table-row-group;

                & > tr {
                    @apply lg:table-row lg:p-0;

                    & > td {
                        @apply lg:table-cell lg:px-3 lg:py-2;

                        &.fi-hidden {
                            @apply lg:table-cell;
                        }

                        /* Make actions column sticky */
                        &:last-child {
                            @apply lg:sticky lg:right-0 lg:z-10 lg:bg-white lg:dark:bg-gray-900;
                            box-shadow: -2px 0 8px -2px rgba(0, 0, 0, 0.1);
                        }

                        /* Ensure data columns take full available width */
                        &:not(:last-child):not(.fi-fo-table-repeater-empty-header-cell) {
                            @apply lg:min-w-[150px] lg:max-w-none;
                        }

                        & .fi-fo-field {
                            @apply lg:gap-y-0;
                        }

                        & .fi-in-entry {
                            @apply lg:gap-y-0;
                        }

                        & .fi-fo-field-label-content {
                            @apply lg:hidden;
                        }

                        & .fi-in-entry-label-content {
                            @apply lg:hidden;
                        }
                    }
                }
            }

            & .fi-fo-table-repeater-actions {
                @apply lg:px-3 lg:py-2;
            }
        }
    }

    & .fi-fo-table-repeater-add {
        @apply flex justify-center w-full;

        &.fi-align-start,
        &.fi-align-left {
            @apply justify-start;
        }

        &.fi-align-end,
        &.fi-align-right {
            @apply justify-end;
        }
    }
    }